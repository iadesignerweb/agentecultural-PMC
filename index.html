<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Agente Municipal de Cultura-PE</title>

<style>
    body { font-family: Arial, sans-serif; background:#fff; margin:0; padding:0; }
    header { text-align:center; padding:20px; font-size:26px; font-weight:bold; }
    #loginBox, #systemBox {
        width:90%; max-width:700px; margin:40px auto;
        border:1px solid #ccc; border-radius:8px;
        background:#f9f9f9; padding:20px;
    }
    input, button {
        width:100%; padding:10px; margin-top:10px; font-size:16px;
    }
    table { width:100%; border-collapse:collapse; margin-top:20px; }
    th, td { border:1px solid #ccc; padding:10px; text-align:left; }
    th { background:#eee; }
    button.small { width:auto; padding:6px 10px; font-size:14px; margin-right:4px; }
    footer { text-align:center; margin-top:40px; padding:20px; color:#555; }
</style>

</head>
<body>

<header>Agente Municipal de Cultura-PE</header>

<!-- LOGIN -->
<div id="loginBox">
    <h3>Acesso Restrito</h3>
    <input type="text" id="loginID" placeholder="ID">
    <input type="password" id="loginSenha" placeholder="Senha">
    <button onclick="login()">Entrar</button>
</div>

<!-- SISTEMA -->
<div id="systemBox" style="display:none;">
    <h3>Gerenciador de Arquivos PDF</h3>

    <input type="file" id="pdfInput" accept="application/pdf">
    <button onclick="processarPDF()">Enviar PDF</button>

    <input type="text" id="pesquisa" placeholder="Pesquisar..." oninput="renderTabela()">

    <table>
        <thead>
            <tr>
                <th>Conteúdo do PDF</th>
                <th>Ação</th>
            </tr>
        </thead>
        <tbody id="tabela"></tbody>
    </table>
</div>

<footer>@Copyright 2025 - Departamento de Cultura Custódia.</footer>

<!-- PDF.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.9.359/pdf.min.js"></script>

<script>
/* ---------------- LOGIN ---------------- */
function login() {
    if (document.getElementById("loginID").value.trim() === "" ||
        document.getElementById("loginSenha").value.trim() === "") {

        alert("Por favor, insira ID e senha.");
        return;
    }

    document.getElementById("loginBox").style.display = "none";
    document.getElementById("systemBox").style.display = "block";
}

/* ---------------- STORAGE ---------------- */
let dados = JSON.parse(localStorage.getItem("listaPDF") || "[]");

function salvar() {
    localStorage.setItem("listaPDF", JSON.stringify(dados));
}

/* ---------------- PROCESSAR PDF ---------------- */
async function processarPDF() {
    const file = document.getElementById("pdfInput").files[0];
    if (!file) {
        alert("Selecione um PDF.");
        return;
    }

    const leitor = new FileReader();

    leitor.onload = async function () {
        const array = new Uint8Array(this.result);
        const pdf = await pdfjsLib.getDocument(array).promise;

        let texto = "";

        for (let p = 1; p <= pdf.numPages; p++) {
            const pagina = await pdf.getPage(p);
            const conteudo = await pagina.getTextContent();
            texto += conteudo.items.map(i => i.str).join(" ") + "\n";
        }

        dados.push({ conteudo: texto });
        salvar();
        renderTabela();

        alert("PDF extraído e listado com sucesso!");
    };

    leitor.readAsArrayBuffer(file);
}

/* ---------------- RENDERIZAÇÃO DA TABELA ---------------- */
function renderTabela() {
    const filtro = document.getElementById("pesquisa").value.toLowerCase();
    const tbody = document.getElementById("tabela");

    tbody.innerHTML = "";

    dados
        .filter(item => item.conteudo.toLowerCase().includes(filtro))
        .forEach((item, index) => {
            tbody.innerHTML += `
                <tr id="linha-${index}">
                    <td id="texto-${index}" contenteditable="false">
                        ${item.conteudo.replace(/\n/g, "<br>")}
                    </td>
                    <td>
                        <button class="small" onclick="editar(${index})">Editar</button>
                        <button class="small" onclick="salvarEdicao(${index})">Salvar</button>
                        <button class="small" onclick="excluir(${index})">Apagar</button>
                    </td>
                </tr>
            `;
        });
}

/* ---------------- EDITAR ---------------- */
function editar(i) {
    const campo = document.getElementById("texto-" + i);
    campo.contentEditable = "true";
    campo.style.background = "#ffffd9";
    campo.focus();
}

/* ---------------- SALVAR EDIÇÃO ---------------- */
function salvarEdicao(i) {
    const campo = document.getElementById("texto-" + i);

    let textoEditado = campo.innerHTML
        .replace(/<br>/g, "\n")
        .replace(/&nbsp;/g, " ")
        .trim();

    dados[i].conteudo = textoEditado;

    campo.contentEditable = "false";
    campo.style.background = "white";

    salvar();
    alert("Alteração salva com sucesso!");
    renderTabela();
}

/* ---------------- EXCLUIR ---------------- */
function excluir(i) {
    if (confirm("Deseja excluir este registro?")) {
        dados.splice(i, 1);
        salvar();
        renderTabela();
    }
}

renderTabela();
</script>

</body>
</html>
